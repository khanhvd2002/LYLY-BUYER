import{R as O}from"./Review-0c012bef.js";import{_ as U,o as d,f as y,a1 as C,a3 as L,h as n,j as p,n as P,p as q,l as S,ab as T,q as b,d as v,i as f,t as _,e as x,w as I,L as k,F as Y,V as X}from"./index-22b5c2ba.js";import{c as B}from"./product-aa49f252.js";import H from"./preOrder-0c142193.js";import{a as V}from"./VChip-99eedeaf.js";import{g as W}from"./rating-321660b4.js";import{V as E}from"./VRating-c203da34.js";import{V as D}from"./VTextField-90eae7b3.js";import"./swiper-vue-ee6ad123.js";import"./VAvatar-d7bb5f07.js";import"./VImg-653cffe0.js";import"./index-772d334d.js";import"./QRcode.vue_vue_type_style_index_0_scoped_7e7556d3_lang-3b978830.js";import"./visa-28f40fd4.js";import"./VCard-ddce212e.js";import"./createSimpleFunctional-9be224d5.js";import"./VDivider-4aed50c9.js";import"./VRow-07882a40.js";import"./VCol-ba52aa3f.js";import"./VCounter-b060678f.js";import"./index-56c5ee2d.js";import"./VInput-52bb4087.js";import"./VList-746651b2.js";import"./ssrBoot-08c7bd55.js";import"./VCheckboxBtn-9f5e1487.js";import"./VSelectionControl-3f59898c.js";import"./VRadioGroup-01c0a5b9.js";import"./lazy-018acb18.js";import"./getScrollParent-7b3d9385.js";import"./index-a4fb869b.js";const M={props:{scale:{type:Number,default:2.5},url:{type:String,required:!0},bigUrl:{type:String,default:null},scroll:{type:Boolean,default:!1},showEidt:{type:Boolean,default:!1}},data(){return{id:null,cover:null,imgbox:null,imgwrap:null,orginUrl:null,bigImgUrl:null,bigOrginUrl:null,imgUrl:null,img:null,canvas:null,ctx:null,rectTimesX:0,rectTimesY:0,imgTimesX:0,imgTimesY:0,init:!1,step:0,bigStep:0,vertical:!1,showImg:!0}},created(){var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",e=t.length,o="";for(let c=0;c<10;c++)o+=t.charAt(Math.floor(Math.random()*e));this.id=o,this.imgUrl=this.url,this.orginUrl=this.url,this.bigImgUrl=this.bigUrl,this.bigOrginUrl=this.bigUrl},watch:{url:function(t){this.imgUrl=t,this.orginUrl=t,this.initTime()},bigUrl:function(){this.bigImgUrl=bigUrl,this.bigOrginUrl=bigUrl,this.initTime()}},mounted(){this.$nextTick(()=>{this.initTime()})},methods:{initTime(){this.init=!1;let t=this.$refs[this.id];this.imgbox=t,this.cover=t.querySelector(".mouse-cover"),this.cover.style.width=this.imgbox.offsetWidth/this.scale+"px",this.cover.style.height=this.imgbox.offsetHeight/this.scale+"px",this.cover.style.left="-100%",this.cover.style.top="-100%",this.imgwrap=t.querySelector("img");let e;this.bigImgUrl?e=this.bigImgUrl:e=this.imgUrl,this.img=new Image,this.img.src=e,this.img.onload=()=>{this.rectTimesX=this.imgbox.offsetWidth/this.scale/this.imgwrap.offsetWidth,this.rectTimesY=this.imgbox.offsetHeight/this.scale/this.imgwrap.offsetHeight,this.imgTimesX=this.img.width/this.imgwrap.offsetWidth,this.imgTimesY=this.img.height/this.imgwrap.offsetHeight,this.vertical=this.img.width<this.img.height,this.init=!0},this.canvas&&(this.canvas.parentNode.removeChild(this.canvas),this.canvas=null),this.canvas=document.createElement("canvas"),this.canvas.className="mouse-cover-canvas",this.canvas.style.position="absolute",this.canvas.style.left=this.imgbox.offsetLeft+this.imgbox.offsetWidth+10+"px",this.canvas.style.top=this.imgbox.offsetTop+"px",this.canvas.style.border="1px solid #eee",this.canvas.style.zIndex="99999",this.canvas.height=this.imgbox.offsetHeight,this.canvas.width=this.imgbox.offsetWidth,this.canvas.style.display="none",document.body.append(this.canvas),this.ctx=this.canvas.getContext("2d"),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},initBox(){this.showImg=!1,this.canvas.style.display="none";let t=this.$refs[this.id],e;this.bigImgUrl?e=this.bigImgUrl:e=this.imgUrl,this.img=new Image,this.img.src=e,this.img.onload=()=>{this.vertical=this.img.width<this.img.height,this.showImg=!0,t.querySelector("img"),setTimeout(()=>{this.rectTimesX=this.imgbox.offsetWidth/this.scale/t.querySelector("img").offsetWidth,this.rectTimesY=this.imgbox.offsetHeight/this.scale/t.querySelector("img").offsetHeight},20)}},mousemove(t){if(!this.init)return!1;let e=this;function o(l){var u=null,w=null,g=l.offsetParent;for(u+=l.offsetLeft,w+=l.offsetTop;g;)navigator.userAgent.indexOf("MSIE 8.0")===-1&&(u+=g.clientLeft,w+=g.clientTop),u+=g.offsetLeft,w+=g.offsetTop,g=g.offsetParent;return{left:u,top:w}}function c(l){return{x:l.clientX-e.cover.offsetWidth/2,y:l.clientY-e.cover.offsetHeight/2}}let s=c(t||event),r=o(this.imgwrap),a={minX:r.left,maxX:r.left+this.imgwrap.offsetWidth-this.cover.offsetWidth,minY:r.top-document.documentElement.scrollTop,maxY:r.top-document.documentElement.scrollTop+this.imgwrap.offsetHeight-this.cover.offsetHeight};s.x>a.maxX&&(s.x=a.maxX),s.x<a.minX&&(s.x=a.minX),s.y>a.maxY&&(s.y=a.maxY),s.y<a.minY&&(s.y=a.minY),this.cover.style.left=s.x+"px",this.cover.style.top=s.y+"px",this.ctx.clearRect(0,0,this.imgwrap.offsetWidth,this.imgwrap.offsetHeight);let h=s.x-(r.left-document.documentElement.scrollLeft),m=s.y-(r.top-document.documentElement.scrollTop);this.ctx.drawImage(this.img,h*this.imgTimesX,m*this.imgTimesY,this.img.width*this.rectTimesX,this.img.height*this.rectTimesY,0,0,this.imgbox.offsetWidth,this.imgbox.offsetHeight)},mouseover(t){if(!this.init)return!1;t=t||event,this.scroll||(t.currentTarget.addEventListener("mousewheel",function(e){e.preventDefault()},!1),t.currentTarget.addEventListener("DOMMouseScroll",function(e){e.preventDefault()},!1)),this.cover.style.display="block",this.canvas.style.display="block"},mouseleave(){if(!this.init)return!1;this.cover.style.display="none",this.canvas.style.display="none"},rotate(t){var e=new Image;if(e.crossOrigin="Anonymous",e.src=this.orginUrl,e.onload=()=>{this.rotateImg(e,t,this.step)},this.bigOrginUrl){var o=new Image;e.crossOrigin="Anonymous",o.src=this.bigOrginUrl,o.onload=()=>{this.rotateImg(o,t,this.bigStep,!0)}}},rotateImg(t,e,o,c=!1){var i=0,s=3;if(t!=null){var r=t.height,a=t.width;o==null&&(o=i),e=="right"?(o++,o>s&&(o=i)):(o--,o<i&&(o=s));var h=document.createElement("canvas"),m=o*90*Math.PI/180,l=h.getContext("2d");switch(h.width=r,h.height=a,l.rotate(m),l.drawImage(t,0,-r),o){case 0:h.width=a,h.height=r,l.drawImage(t,0,0);break;case 1:h.width=r,h.height=a,l.rotate(m),l.drawImage(t,0,-r);break;case 2:h.width=a,h.height=r,l.rotate(m),l.drawImage(t,-a,-r);break;case 3:h.width=r,h.height=a,l.rotate(m),l.drawImage(t,-a,0);break}var u=h.toDataURL();c?(this.bigImgUrl=u,this.bigStep=o,this.initBox()):(this.imgUrl=u,this.step=o,this.$nextTick(()=>{this.initBox()}))}}}},N=t=>(q("data-v-b098dd01"),t=t(),S(),t),R=["src"],A=N(()=>n("div",{class:"mouse-cover"},null,-1)),z={key:0,class:"edit-wrap"};function F(t,e,o,c,i,s){return d(),y("div",{class:P(["magnifier-box",i.vertical?"vertical":""]),ref:i.id,onMousemove:e[2]||(e[2]=(...r)=>s.mousemove&&s.mousemove(...r)),onMouseover:e[3]||(e[3]=(...r)=>s.mouseover&&s.mouseover(...r)),onMouseleave:e[4]||(e[4]=(...r)=>s.mouseleave&&s.mouseleave(...r))},[C(n("img",{src:i.imgUrl,alt:""},null,8,R),[[L,i.showImg]]),A,o.showEidt?(d(),y("div",z,[n("span",{class:"rotate-left",onClick:e[0]||(e[0]=r=>s.rotate("left"))}),n("span",{class:"rotate-right",onClick:e[1]||(e[1]=r=>s.rotate("right"))})])):p("",!0)],34)}const j=U(M,[["render",F],["__scopeId","data-v-b098dd01"]]);const Z={name:"product_detail",components:{PreOrder:H,Review:O,PicZoom:j},created(){this.getProduct(this.$route.query.id),this.getDataReview()},computed:{error(){return this.product.quantity<=0}},data(){return{error:!1,rules:{required:t=>{if(!t)return this.error=!0,"Yêu cầu nhập số lượng mua"},counter:t=>t.length>0&&t||"Lớn hơn 0",checkNum:t=>!t||isNaN(t)||t<=0?(this.error=!0,"Số lượng mua lớn hơn 0 "):t>this.product.quantity?(this.error=!0,"Số lượng phải bé hơn "+this.product.quantity):(this.error=!1,!0)},reviewList:[],formOrder:{product_detail:{},quantity:1,flowPrice:0},formCart:{product_id:"",quantity:1},orderArr:[],product:{image:"https://inchi.vn/data/thumbnails/qua-tang/qua-tang-gia-dinh-ban-be/coc-in-ten-va-ngay-thang-0.jpg",name:"",price:"",rating:5,description:""},statusOrder:0}},methods:{getDataReview(){W({product_id:this.$route.query.id}).then(t=>{this.reviewList=t.data,console.log(this.reviewList)})},getProduct(t){B(t).then(e=>{this.product=e.data})},checkLogin(){return localStorage.getItem("access_token")},payProduct(){this.checkLogin()?(this.statusOrder=1,this.formOrder.flowPrice=this.product.price*this.formOrder.quantity,this.formOrder.product_detail=this.product,this.orderArr.push(this.formOrder)):(this.$moshaToast("Bạn chưa đăng nhập",{type:"warning",transition:"slide",timeout:3e3}),T.push("/login"))},handleAddToCart(){this.checkLogin()?(this.formCart.product_id=this.product.id,this.formCart.quantity=this.formOrder.quantity,V(this.formCart).then(t=>{this.$moshaToast("Thêm giỏ hàng thành công",{type:"success",transition:"slide",hideProgressBar:"true"})}).catch(t=>{this.$moshaToast("Lỗi xảy ra khi thêm",{type:"warning",transition:"slide",hideProgressBar:"true"})})):(this.$moshaToast("Bạn chưa đăng nhập",{type:"warning",transition:"slide",timeout:3e3}),T.push("/login"))}}},G=t=>(q("data-v-68fe828b"),t=t(),S(),t),J={key:0,style:{"background-color":"white",padding:".2rem 1.6rem","border-radius":"12px"}},K={class:"product-container"},Q={class:"product-img"},$={class:"img-wrap"},tt={class:"zoom-img"},et={class:"flex mt-1"},it={class:"product-content"},st={class:"name"},rt={class:"review"},ot={style:{display:"flex","align-items":"center"}},nt={key:0,class:"sold-out-detail"},at={class:"product-price"},ht={class:"pro-num"},lt={class:"action"},ct={class:"mt-2"},mt={class:"product-desc"},dt=G(()=>n("h3",{class:"header-text"},"Thông tin sản phẩm",-1)),ut=["innerHTML"];function gt(t,e,o,c,i,s){const r=b("pic-zoom"),a=b("Review"),h=b("PreOrder");return d(),y(Y,null,[i.statusOrder===0?(d(),y("div",J,[n("div",K,[n("div",Q,[n("div",$,[n("div",tt,[v(r,{style:{"border-radius":"8px",overflow:"hidden"},url:i.product.image_url,scale:3,alt:""},null,8,["url"])])]),n("div",et,[v(X,{icon:"mdi-heart"}),f(" Thêm vào yêu thích ")])]),n("div",it,[n("span",st,_(i.product.name),1),n("div",rt,[n("div",ot,[n("strong",null,_(parseFloat(i.product.avg_rating)),1),v(E,{disabled:"","half-increments":"","model-value":i.product.avg_rating,size:"small"},null,8,["model-value"])]),n("span",null,"  | "+_(i.product.total_sold)+" sản phẩm đã bán",1)]),i.product.quantity==0?(d(),y("span",nt,"Bán hết")):p("",!0),n("div",at,[f(" Giá: "),n("span",null,_(t.formatPrice(i.product.price)),1)]),n("div",ht,[f(" Số lượng: "),v(D,{disabled:i.product.quantity==0,density:"compact",type:"number",modelValue:i.formOrder.quantity,"onUpdate:modelValue":e[0]||(e[0]=m=>i.formOrder.quantity=m),rules:[i.rules.required,i.rules.checkNum],min:"1",max:i.product.quantity},null,8,["disabled","modelValue","rules","max"]),f(" "+_(i.product.quantity)+" sản phẩm có sẵn ",1)]),n("div",lt,[i.product.quantity!=0?(d(),x(k,{key:0,disabled:i.error,color:"success",onClick:s.payProduct},{default:I(()=>[f("Đặt ngay")]),_:1},8,["disabled","onClick"])):p("",!0),i.product.quantity!=0?(d(),x(k,{key:1,disabled:i.error,onClick:s.handleAddToCart,color:"warning"},{default:I(()=>[f("Thêm giỏ hàng ")]),_:1},8,["disabled","onClick"])):p("",!0)])])]),n("div",ct,[v(a,{"review-arr":i.reviewList},null,8,["review-arr"])]),n("div",mt,[dt,n("div",{innerHTML:i.product.description},null,8,ut)])])):p("",!0),i.statusOrder===1?(d(),x(h,{key:1,order:i.orderArr},null,8,["order"])):p("",!0)],64)}const zt=U(Z,[["render",gt],["__scopeId","data-v-68fe828b"]]);export{zt as default};
